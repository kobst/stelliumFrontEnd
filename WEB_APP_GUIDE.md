# StelliumApp Web Migration Guide

> Comprehensive documentation for building the React web version of StelliumApp

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Navigation Hierarchy](#2-navigation-hierarchy)
3. [Architecture Overview](#3-architecture-overview)
4. [Core User Flow 1: Authentication & Onboarding](#4-core-flow-1-authentication--onboarding)
5. [Core User Flow 2: Birth Chart Analysis](#5-core-flow-2-birth-chart-analysis)
6. [Core User Flow 3: Relationship Analysis](#6-core-flow-3-relationship-analysis)
7. [Core User Flow 4: Horoscope Generation](#7-core-flow-4-horoscope-generation)
8. [Core User Flow 5: AI Chat Interactions](#8-core-flow-5-ai-chat-interactions)
9. [Supporting Flows](#9-supporting-flows)
10. [Complete API Reference](#10-complete-api-reference)
11. [Data Models Reference](#11-data-models-reference)
12. [State Management for Web](#12-state-management-for-web)
13. [Web Implementation Recommendations](#13-web-implementation-recommendations)

---

## 1. Executive Summary

### Application Overview

StelliumApp is an AI-powered astrology guidance application that provides:
- **Birth Chart Analysis**: Comprehensive natal chart interpretation with 86-task AI analysis workflow
- **Relationship Analysis**: 5-cluster scoring system (Harmony, Passion, Connection, Stability, Growth) for compatibility
- **Horoscope Generation**: Daily, weekly, monthly, and custom transit-based horoscopes
- **AI Chat**: Context-aware conversations about charts, relationships, and transits

### Key Features by Priority

| Feature | Priority | Complexity | Description |
|---------|----------|------------|-------------|
| Authentication | Critical | Medium | Firebase Auth with Google, Apple, Email |
| Birth Chart View | Critical | High | SVG wheel rendering, 5-tab analysis UI |
| Horoscope | Critical | Medium | Daily/weekly/monthly + custom transits |
| Relationships | High | High | 5-cluster scoring, radar charts |
| AI Chat | High | Medium | Context-aware chat with element selection |
| Guest Charts | Medium | Medium | Add/manage other people's charts |
| Celebrity Features | Low | Low | Browse and compare with celebrities |

### Technology Stack for Web

| Layer | Recommended Technology |
|-------|----------------------|
| Framework | React 18+ with TypeScript |
| Routing | React Router v6 |
| State Management | Zustand (matching mobile) |
| Forms | React Hook Form |
| HTTP Client | Fetch API with custom wrapper |
| Authentication | Firebase Auth Web SDK |
| Charts/Visualization | D3.js or custom SVG |
| Styling | Tailwind CSS or Styled Components |

---

## 2. Navigation Hierarchy

### Complete Menu Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MAIN TAB BAR                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   HOROSCOPE     â”‚   BIRTH CHARTS  â”‚  RELATIONSHIPS  â”‚   CELEBRITIES   â”‚SETTINGS â”‚
â”‚       â¬‡         â”‚        â¬‡        â”‚        â¬‡        â”‚       â¬‡         â”‚   â¬‡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Level 1: Main Tab Bar (Bottom Navigation)

| Tab | Icon | Description |
|-----|------|-------------|
| **Horoscope** | â˜‰ | Daily horoscope and transit forecasts |
| **Birth Charts** | â­ | User's chart + guest charts library |
| **Relationships** | â™¡ | Compatibility analysis library |
| **Celebrities** | ğŸ‘¤ | Celebrity database (feature flag) |
| **Settings** | âš™ | Via profile modal overlay |

---

### Level 2: Within Each Tab

#### HOROSCOPE TAB

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HOROSCOPE SCREEN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Today  â”‚  â”‚ This Week â”‚  â”‚ This Month â”‚  â”‚ Ask Stellium  â”‚  â”‚
â”‚  â”‚ (Daily) â”‚  â”‚ (Weekly)  â”‚  â”‚ (Monthly)  â”‚  â”‚    (Chat)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚             â”‚               â”‚                â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                              â”‚                                   â”‚
â”‚                    [Select Transits Button]                      â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                 â”‚ Transit Selection Screenâ”‚                      â”‚
â”‚                 â”‚  (multi-select list)    â”‚                      â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                             â”‚                                    â”‚
â”‚                             â–¼                                    â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                 â”‚Custom Horoscope Screen  â”‚                      â”‚
â”‚                 â”‚  (generated result)     â”‚                      â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Horoscope Period Tabs:**
| Tab | Data Source | Unlock Required |
|-----|-------------|-----------------|
| Today | `/horoscope/daily` | Free tier: Yes |
| This Week | `/horoscope/weekly` | Premium |
| This Month | `/horoscope/monthly` | Premium |
| Ask Stellium | Chat with transit context | Requires horoscope generated |

---

#### BIRTH CHARTS TAB

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CHART SELECTION SCREEN                          â”‚
â”‚              (Library of all birth charts)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  ğŸ‘¤ Your Birth Chart                     â”‚ â† Always first     â”‚
â”‚  â”‚     "Leo Sun, Scorpio Moon, Virgo Rising"â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  ğŸ‘¤ Guest Chart: Mom                     â”‚                    â”‚
â”‚  â”‚     "Pisces Sun, Cancer Moon"            â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  ğŸ‘¤ Guest Chart: Partner                 â”‚                    â”‚
â”‚  â”‚     "Aries Sun, Libra Moon"              â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚                    [+ Add Birth Chart]                           â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”‚ Guest Onboarding Wizard â”‚                         â”‚
â”‚              â”‚ (same as user onboarding)â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    (tap any chart)
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CHART SCREEN                                â”‚
â”‚                (Individual Chart Analysis)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ Overview â”‚ Planets  â”‚ Patterns â”‚   360Â°   â”‚ Ask Stellium â”‚  â”‚
â”‚   â”‚          â”‚          â”‚          â”‚ Analysis â”‚    (Chat)    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚          â”‚          â”‚          â”‚             â”‚         â”‚
â”‚        â–¼          â–¼          â–¼          â–¼             â–¼         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚Key      â”‚â”‚Planet   â”‚â”‚Stelliumsâ”‚â”‚6 Broad  â”‚  â”‚ Chat UI  â”‚   â”‚
â”‚   â”‚Positionsâ”‚â”‚Details  â”‚â”‚Grand    â”‚â”‚Topics   â”‚  â”‚ (locked  â”‚   â”‚
â”‚   â”‚Elements â”‚â”‚+ Interp â”‚â”‚Trines   â”‚â”‚Deep     â”‚  â”‚  until   â”‚   â”‚
â”‚   â”‚Modality â”‚â”‚         â”‚â”‚T-Squaresâ”‚â”‚Analysis â”‚  â”‚  360Â°    â”‚   â”‚
â”‚   â”‚Quadrantsâ”‚â”‚         â”‚â”‚         â”‚â”‚         â”‚  â”‚complete) â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚                       â”‚
â”‚                              (tap category)                      â”‚
â”‚                                         â”‚                       â”‚
â”‚                                         â–¼                       â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                          â”‚Chart Category Detail Scrâ”‚            â”‚
â”‚                          â”‚  â€¢ Subtopic tabs        â”‚            â”‚
â”‚                          â”‚  â€¢ Synthesis tab        â”‚            â”‚
â”‚                          â”‚  â€¢ Key aspects codes    â”‚            â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Chart Screen Tabs:**
| Tab | Content | Prerequisite |
|-----|---------|--------------|
| Overview | Sun/Moon/Rising, Elements, Modalities, Quadrants | User created |
| Planets | All planet positions with interpretations | User created |
| Patterns | Stelliums, Grand Trines, T-Squares, etc. | User created |
| 360Â° Analysis | 6 broad categories with subtopics | Workflow complete |
| Ask Stellium | AI chat about birth chart | 360Â° Analysis complete |

**360Â° Analysis Categories (6 Broad Topics):**
1. Self-Expression and Identity
2. Emotional Foundations and Home Life
3. Relationships and Social Connections
4. Career, Purpose, and Public Image
5. Unconscious Drives and Spiritual Growth
6. Communication, Learning, and Belief Systems

---

#### RELATIONSHIPS TAB

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RELATIONSHIPS SCREEN                            â”‚
â”‚               (Library of all relationships)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  â™¡ You & Partner                         â”‚                    â”‚
â”‚  â”‚     Overall: 78 | Tier: Flourishing      â”‚                    â”‚
â”‚  â”‚     Dominant: Harmony | Challenge: Growthâ”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  â™¡ You & Taylor Swift                    â”‚ â† Celebrity        â”‚
â”‚  â”‚     Overall: 65 | Tier: Emerging         â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚                    [+ Add Relationship]                          â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚Create Relationship Screen   â”‚                     â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚
â”‚              â”‚  â”‚ Guests  â”‚ Celebrities â”‚  â”‚ â† Two tabs          â”‚
â”‚              â”‚  â”‚  Tab    â”‚    Tab      â”‚  â”‚                     â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚
â”‚              â”‚  Select Person A            â”‚                     â”‚
â”‚              â”‚  Select Person B            â”‚                     â”‚
â”‚              â”‚  [Create Relationship]      â”‚                     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    (tap any relationship)
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                RELATIONSHIP ANALYSIS SCREEN                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Scores  â”‚ Overview â”‚  Charts  â”‚   360Â°   â”‚ Ask Stellium â”‚  â”‚
â”‚   â”‚          â”‚          â”‚          â”‚ Analysis â”‚    (Chat)    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚          â”‚          â”‚          â”‚             â”‚         â”‚
â”‚        â–¼          â–¼          â–¼          â–¼             â–¼         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚5-Clusterâ”‚â”‚Initial  â”‚â”‚Sub-tabs:â”‚â”‚Per-      â”‚  â”‚ Chat UI  â”‚   â”‚
â”‚   â”‚Radar    â”‚â”‚AI Over- â”‚â”‚         â”‚â”‚Cluster  â”‚  â”‚ (locked  â”‚   â”‚
â”‚   â”‚Chart    â”‚â”‚view     â”‚â”‚â€¢Synastryâ”‚â”‚Analysis:â”‚  â”‚  until   â”‚   â”‚
â”‚   â”‚         â”‚â”‚         â”‚â”‚â€¢Compsiteâ”‚â”‚â€¢Support â”‚  â”‚  360Â°    â”‚   â”‚
â”‚   â”‚Overall  â”‚â”‚         â”‚â”‚         â”‚â”‚â€¢Challngeâ”‚  â”‚complete) â”‚   â”‚
â”‚   â”‚Tier     â”‚â”‚         â”‚â”‚         â”‚â”‚â€¢Synthsisâ”‚  â”‚          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                â”‚                       â”‚
â”‚        â–¼                                â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚Cluster Detail â”‚            â”‚Relationship Category Scrâ”‚       â”‚
â”‚  â”‚(tap a cluster)â”‚            â”‚  â€¢ Synastry panel       â”‚       â”‚
â”‚  â”‚               â”‚            â”‚  â€¢ Composite panel      â”‚       â”‚
â”‚  â”‚â€¢ Support panelâ”‚            â”‚  â€¢ Synthesis panel      â”‚       â”‚
â”‚  â”‚â€¢ Challenge pnlâ”‚            â”‚  â€¢ Key aspects          â”‚       â”‚
â”‚  â”‚â€¢ Keystone asptâ”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Relationship Analysis Tabs:**
| Tab | Content | Prerequisite |
|-----|---------|--------------|
| Scores | 5-cluster radar chart, overall score, tier, profile | Fast scoring (2-5s) |
| Overview | AI-generated relationship dynamics summary | Fast scoring |
| Charts | Synastry wheel, Composite wheel (sub-tabs) | Fast scoring |
| 360Â° Analysis | Full cluster panels (Synastry + Composite) | Full workflow |
| Ask Stellium | AI chat about relationship | 360Â° Analysis complete |

**5-Cluster Scoring System:**
| Cluster | Description | Score Range |
|---------|-------------|-------------|
| Harmony | Overall compatibility and ease | 0-100 |
| Passion | Sexual chemistry and attraction | 0-100 |
| Connection | Emotional and mental bonding | 0-100 |
| Stability | Long-term potential | 0-100 |
| Growth | Transformative potential | 0-100 |

**Overall Tiers:**
- Thriving (85+)
- Flourishing (70-84)
- Emerging (55-69)
- Building (40-54)
- Developing (<40)

---

#### CELEBRITIES TAB

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CELEBRITY SCREEN                              â”‚
â”‚               (Browse celebrity database)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  ğŸ” Search celebrities...                â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  ğŸ‘¤ Taylor Swift                         â”‚                    â”‚
â”‚  â”‚     Sagittarius Sun | Dec 13, 1989       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  ğŸ‘¤ BeyoncÃ©                              â”‚                    â”‚
â”‚  â”‚     Virgo Sun | Sep 4, 1981              â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                      (tap celebrity)
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 CELEBRITY DETAIL SCREEN                          â”‚
â”‚          (Same structure as Chart Screen)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ Overview â”‚ Planets  â”‚ Patterns â”‚   360Â°   â”‚ Ask Stellium â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚              [Compare with Your Chart] Button                    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚              Creates celebrity relationship                      â”‚
â”‚              â†’ Navigates to Relationship Analysis                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Level 3: Detail Views & Sub-tabs

#### Chart Category Detail Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CHART CATEGORY DETAIL SCREEN                          â”‚
â”‚      (e.g., "Relationships and Social Connections")              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ Core       â”‚ Love Style â”‚ Sexual     â”‚ Commitment â”‚Synth- â”‚ â”‚
â”‚   â”‚ Desires    â”‚            â”‚ Nature     â”‚ Approach   â”‚esis   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚   Content:                                                       â”‚
â”‚   â€¢ Subtopic analysis text                                       â”‚
â”‚   â€¢ Key aspects referenced                                       â”‚
â”‚   â€¢ Energy pattern indicators                                    â”‚
â”‚   â€¢ Tension flow analysis (support vs challenge density)        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Relationship Category Detail Screen (Cluster Deep-Dive)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          RELATIONSHIP CATEGORY DETAIL SCREEN                     â”‚
â”‚               (e.g., "Harmony Cluster")                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚   Synastry     â”‚   Composite    â”‚   Synthesis    â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                  â”‚
â”‚   Per sub-tab:                                                   â”‚
â”‚   â€¢ Support Panel (positive aspects)                             â”‚
â”‚   â€¢ Challenge Panel (difficult aspects)                          â”‚
â”‚   â€¢ Keystone aspects (most impactful)                           â”‚
â”‚   â€¢ Star ratings per aspect                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Settings & Account (Profile Modal)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PROFILE MODAL                                â”‚
â”‚              (Overlay accessible from header)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  ğŸ‘¤ Profile Photo                        â”‚                    â”‚
â”‚  â”‚     John Doe                             â”‚                    â”‚
â”‚  â”‚     Premium Member                        â”‚                    â”‚
â”‚  â”‚     Credits: 150                          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚  Menu Options:                                                   â”‚
â”‚  â”œâ”€â”€ Manage Account â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚   â”œâ”€â”€ Export My Data                   â”‚                      â”‚
â”‚  â”‚   â””â”€â”€ Delete Account â”€â”€â”               â”‚                      â”‚
â”‚  â”‚                        â–¼               â”‚                      â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                      â”‚
â”‚  â”‚              â”‚Delete Account   â”‚       â”‚                      â”‚
â”‚  â”‚              â”‚Screen           â”‚       â”‚                      â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                      â”‚
â”‚  â”‚                       â–¼               â”‚                      â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                      â”‚
â”‚  â”‚              â”‚Account Deleted  â”‚       â”‚                      â”‚
â”‚  â”‚              â”‚Screen           â”‚       â”‚                      â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                      â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€â”€ Subscription â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚   â”‚  Current tier, usage, manage       â”‚                      â”‚
â”‚  â”‚   â”‚  Cancel/Reactivate options         â”‚                      â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€â”€ Credits â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚   â”‚  Credit balance                    â”‚                      â”‚
â”‚  â”‚   â”‚  Purchase credit packs             â”‚                      â”‚
â”‚  â”‚   â”‚  Subscription upsell               â”‚                      â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€â”€ Theme Toggle (Light/Dark/System)                            â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€â”€ Sign Out                                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Navigation Summary Table

| Level | Screen | Parent | Child Screens/Tabs |
|-------|--------|--------|-------------------|
| 0 | Auth Screen | - | Onboarding Wizard |
| 0 | Onboarding Wizard | Auth | Main App |
| 1 | **Horoscope** (Tab) | Tab Bar | Today, This Week, This Month, Ask Stellium |
| 2 | Transit Selection | Horoscope | Custom Horoscope |
| 3 | Custom Horoscope | Transit Selection | - |
| 1 | **Birth Charts** (Tab) | Tab Bar | Chart Selection |
| 2 | Chart Selection | Charts Tab | Chart Screen, Guest Onboarding |
| 3 | Chart Screen | Selection | Overview, Planets, Patterns, 360Â°, Chat |
| 4 | Chart Category Detail | 360Â° Tab | Subtopic tabs |
| 1 | **Relationships** (Tab) | Tab Bar | Relationships List |
| 2 | Relationships List | Rel Tab | Create, Analysis |
| 3 | Create Relationship | List | Guests Tab, Celebrities Tab |
| 3 | Relationship Analysis | List | Scores, Overview, Charts, 360Â°, Chat |
| 4 | Charts Sub-tabs | Analysis | Synastry, Composite |
| 4 | Category Detail | 360Â° Tab | Synastry, Composite, Synthesis panels |
| 1 | **Celebrities** (Tab) | Tab Bar | Celebrity List |
| 2 | Celebrity List | Celeb Tab | Celebrity Detail |
| 3 | Celebrity Detail | List | Same as Chart Screen |
| 1 | **Settings** (Modal) | Header | Account, Subscription, Credits |
| 2 | Manage Account | Settings | Delete Account |
| 3 | Delete Account | Manage | Account Deleted |

---

## 3. Architecture Overview

### Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Web Application                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Routes  â”‚â”€â”€â”€â–¶â”‚  Pages   â”‚â”€â”€â”€â–¶â”‚  Hooks   â”‚â”€â”€â”€â–¶â”‚   API    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚              â”‚              â”‚                â”‚         â”‚
â”‚        â”‚              â–¼              â–¼                â”‚         â”‚
â”‚        â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚         â”‚
â”‚        â”‚        â”‚Componentsâ”‚  â”‚  Store   â”‚           â”‚         â”‚
â”‚        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ (Zustand)â”‚           â”‚         â”‚
â”‚        â”‚              â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚         â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Backend API (Existing)                       â”‚
â”‚  â€¢ User Management    â€¢ Birth Chart Analysis                     â”‚
â”‚  â€¢ Relationship Scoring â€¢ Horoscope Generation                  â”‚
â”‚  â€¢ AI Chat            â€¢ Subscription Management                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚â”€â”€â”€â”€â–¶â”‚ AuthScreen  â”‚â”€â”€â”€â”€â–¶â”‚ Firebase    â”‚â”€â”€â”€â”€â–¶â”‚ Backend â”‚
â”‚         â”‚     â”‚             â”‚     â”‚ Auth        â”‚     â”‚ API     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                    â”‚                  â”‚
                     â”‚                    â”‚                  â”‚
                     â”‚              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”           â”‚
                     â”‚              â”‚ ID Token  â”‚           â”‚
                     â”‚              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
                     â”‚                    â”‚                  â”‚
                     â”‚              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”           â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ API Calls â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ w/ Bearer  â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Client Configuration

The API client uses endpoint-specific timeout and retry configurations:

```typescript
// Standard endpoints: 30s timeout, no retry on timeout
// Chat endpoints: 60s timeout, retry on timeout
// Horoscope endpoints: 90-120s timeout, retry with delays (2-7s)

interface EndpointConfig {
  timeout: number;
  retryOnTimeout: boolean;
  maxRetries?: number;
  retryDelays?: number[];  // Delays before each retry
}

const ENDPOINT_CONFIGS = [
  { pattern: '/chat', config: { timeout: 60000, retryOnTimeout: true } },
  { pattern: '/enhanced-chat', config: { timeout: 60000, retryOnTimeout: true } },
  { pattern: /\/horoscope\/daily/, config: { timeout: 90000, retryOnTimeout: true, maxRetries: 2, retryDelays: [2000, 5000] } },
  { pattern: /\/horoscope\/weekly/, config: { timeout: 90000, retryOnTimeout: true, maxRetries: 2, retryDelays: [2000, 5000] } },
  { pattern: /\/horoscope\/monthly/, config: { timeout: 120000, retryOnTimeout: true, maxRetries: 2, retryDelays: [3000, 7000] } },
  { pattern: /\/horoscope\/custom/, config: { timeout: 120000, retryOnTimeout: true, maxRetries: 2, retryDelays: [3000, 7000] } },
];
```

**Important**: Horoscope endpoints require delays before retries because the backend generates batch horoscopes (60-90s). Without delays, retries trigger duplicate LLM calls.

---

## 4. Core Flow 1: Authentication & Onboarding

### Flow Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SplashScreen  â”‚â”€â”€â”€â–¶â”‚OnboardingCarouselâ”‚â”€â”€â”€â–¶â”‚    AuthScreen       â”‚â”€â”€â”€â–¶â”‚  Onboarding  â”‚
â”‚               â”‚    â”‚   (first-time)   â”‚    â”‚ (Google/Apple/Email)â”‚    â”‚    Wizard    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                               â”‚
                                                                               â–¼
                                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                        â”‚  Main App    â”‚
                                                                        â”‚ (Tab Nav)    â”‚
                                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen: AuthScreen

**Purpose**: Handle all authentication methods

**Authentication Methods**:
1. Google Sign-In
2. Apple Sign-In (iOS/Safari)
3. Email/Password

**Firebase Integration**:
```typescript
// Web SDK equivalent
import { getAuth, signInWithPopup, GoogleAuthProvider, OAuthProvider } from 'firebase/auth';

const auth = getAuth();

// Google Sign-In
const googleProvider = new GoogleAuthProvider();
const result = await signInWithPopup(auth, googleProvider);

// Apple Sign-In
const appleProvider = new OAuthProvider('apple.com');
const result = await signInWithPopup(auth, appleProvider);
```

### Screen: UserOnboardingWizard

**Purpose**: Collect user birth data after authentication

**Steps**:
1. **Name & Gender Step**
   - First name, Last name
   - Gender selection (male/female/other)
   - Pre-fills from Google/Apple profile when available

2. **Birth Location Step**
   - Google Places Autocomplete
   - Captures: place name, latitude, longitude

3. **Birth Date & Time Step**
   - Date picker (year, month, day)
   - Time picker (hour, minute)
   - "I don't know my birth time" toggle

4. **Review Step**
   - Summary of entered data
   - Optional profile photo upload
   - Submit button

### APIs Used

#### Create User (Known Birth Time)

```typescript
// POST /createUser
interface CreateUserRequest {
  firebaseUid: string;
  firstName: string;
  lastName: string;
  dateOfBirth: string;       // "YYYY-MM-DD"
  placeOfBirth: string;
  time: string;              // "HH:MM" (24-hour)
  lat?: number;
  lon?: number;
  tzone?: number;            // Timezone offset
  gender?: string;
  unknownTime?: boolean;
}

interface UserResponse {
  id: string;
  name: string;
  birthChart?: any;
  birthData: CreateUserRequest;
  createdAt: string;
  updatedAt: string;
}
```

#### Create User (Unknown Birth Time)

```typescript
// POST /createUserUnknownTime
interface CreateUserUnknownTimeRequest {
  firebaseUid: string;
  firstName: string;
  lastName: string;
  gender: string;
  placeOfBirth: string;
  dateOfBirth: string;
  email: string;
  lat: number;
  lon: number;
  tzone: number;
}
```

#### Get User by Firebase UID

```typescript
// POST /getUserByFirebaseUid
// Request: { firebaseUid: string }
// Response: SubjectDocument (see Data Models)
```

#### Profile Photo Upload

```typescript
// Step 1: Get presigned URL
// POST /subjects/{subjectId}/profile-photo/presigned-url
// Request: { contentType?: string }
// Response: { uploadUrl: string; photoKey: string; expiresIn: number }

// Step 2: Upload to S3 using presigned URL
// PUT {uploadUrl} with image data

// Step 3: Confirm upload
// POST /subjects/{subjectId}/profile-photo/confirm
// Request: { photoKey: string }
// Response: { profilePhotoUrl: string; profilePhotoKey: string; updatedAt: string }
```

### Web Implementation Notes

#### Google Places Autocomplete for Web

```typescript
// Use @react-google-maps/api or direct Google Maps JavaScript API
import { useLoadScript, Autocomplete } from '@react-google-maps/api';

const libraries = ['places'];

function LocationInput() {
  const { isLoaded } = useLoadScript({
    googleMapsApiKey: process.env.REACT_APP_GOOGLE_API_KEY,
    libraries,
  });

  const [autocomplete, setAutocomplete] = useState(null);

  const onPlaceChanged = () => {
    if (autocomplete) {
      const place = autocomplete.getPlace();
      const location = {
        name: place.formatted_address,
        lat: place.geometry.location.lat(),
        lng: place.geometry.location.lng(),
      };
      // Handle location
    }
  };

  return (
    <Autocomplete
      onLoad={setAutocomplete}
      onPlaceChanged={onPlaceChanged}
    >
      <input type="text" placeholder="Enter birth location" />
    </Autocomplete>
  );
}
```

#### Form Validation with React Hook Form

```typescript
import { useForm } from 'react-hook-form';

interface OnboardingFormData {
  firstName: string;
  lastName: string;
  gender: 'male' | 'female' | 'other';
  birthLocation: string;
  birthDate: Date;
  birthTime: string;
  unknownBirthTime: boolean;
}

function OnboardingWizard() {
  const { register, handleSubmit, watch, formState: { errors } } = useForm<OnboardingFormData>();

  const unknownTime = watch('unknownBirthTime');

  const onSubmit = async (data: OnboardingFormData) => {
    if (data.unknownBirthTime) {
      await usersApi.createUserUnknownTime({...});
    } else {
      await usersApi.createUser({...});
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      {/* Step-based form fields */}
    </form>
  );
}
```

#### Routing Structure

```typescript
// React Router v6
import { Routes, Route, Navigate } from 'react-router-dom';

function AppRoutes() {
  const { isAuthenticated, hasCompletedOnboarding } = useAuth();

  return (
    <Routes>
      {/* Public routes */}
      <Route path="/auth" element={<AuthPage />} />

      {/* Onboarding (authenticated but no profile) */}
      <Route
        path="/onboarding"
        element={
          isAuthenticated && !hasCompletedOnboarding
            ? <OnboardingWizard />
            : <Navigate to="/" />
        }
      />

      {/* Protected routes */}
      <Route element={<ProtectedRoute />}>
        <Route path="/" element={<Navigate to="/horoscope" />} />
        <Route path="/horoscope/*" element={<HoroscopeRoutes />} />
        <Route path="/chart/*" element={<ChartRoutes />} />
        <Route path="/relationships/*" element={<RelationshipsRoutes />} />
        <Route path="/settings/*" element={<SettingsRoutes />} />
      </Route>
    </Routes>
  );
}
```

---

## 5. Core Flow 2: Birth Chart Analysis

### Flow Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ChartSelectionScr â”‚â”€â”€â”€â–¶â”‚  ChartScreen  â”‚â”€â”€â”€â–¶â”‚ChartCategoryDetailScr  â”‚
â”‚ (chart library)  â”‚    â”‚  (5 tabs)     â”‚    â”‚    (deep analysis)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen: ChartSelectionScreen

**Purpose**: Display user's birth chart and guest charts

**Features**:
- User's own chart at top
- List of guest charts below
- "Add Birth Chart" floating button
- Pull-to-refresh support

### Screen: ChartScreen (Main Chart View)

**Purpose**: Display birth chart with multi-tab analysis interface

**Tab Structure**:

| Tab | Content | Data Required |
|-----|---------|---------------|
| **Overview** | Key planetary positions, elements, modalities | birthChart, basicAnalysis |
| **Planets** | Detailed planet positions with interpretations | birthChart, planets analysis |
| **Patterns** | Stelliums, grand trines, T-squares | birthChart.patterns |
| **360Â° Analysis** | Full AI-powered analysis (6 broad categories) | broadCategoryAnalyses |
| **Ask Stellium** | Chat interface (locked until 360Â° complete) | Chat history, context |

**Sub-views within Chart Tab**:
- Chart Wheel (SVG visualization)
- Tables (planets, aspects, houses)

### Analysis Workflow (86 Tasks)

The birth chart analysis runs as a Step Functions workflow with ~86 tasks:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Start Analysis â”‚â”€â”€â”€â”€â–¶â”‚  Poll Status    â”‚â”€â”€â”€â”€â–¶â”‚  Get Complete   â”‚
â”‚  (POST)         â”‚     â”‚  (every 3s)     â”‚     â”‚  Data (POST)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                        â”‚
         â”‚                      â–¼                        â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Show Progress â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (0-86 tasks)  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### APIs Used

#### Start Full Analysis

```typescript
// POST /analysis/start-full
// Request: { userId: string }
interface AnalysisWorkflowResponse {
  success: boolean;
  workflowId: string;
  userId: string;
  status: 'in_progress' | 'completed' | 'completed_with_failures' | 'failed' | 'unknown';
  completed: boolean;
  phase: 'running' | 'complete';
  stepFunctionStatus: string;
  startedAt?: string;
  completedAt?: string;
  executionArn?: string;
  message: string;
  failures?: {
    totalTasks: number;
    completedTasks: number;
    failedTasks: number;
    completionRate: number;
  };
}
```

#### Poll Analysis Status

```typescript
// POST /analysis/full-status
// Request: { userId: string; workflowId: string }
// Response: AnalysisWorkflowResponse (same as above)
```

#### Get Complete Analysis Data

```typescript
// POST /workflow/get-complete-data
// Request: { userId: string; workflowId: string }
interface ChartAnalysisResponse {
  birthChartAnalysisId: string;
  workflowStatus?: WorkflowStatus;
  interpretation: {
    basicAnalysis: BasicAnalysis;
    broadCategoryAnalyses?: BroadCategoryAnalyses;
    analysisMetadata?: AnalysisMetadata;
    selectionData?: SelectionData;
    SubtopicAnalysis?: SubtopicAnalysis;  // Legacy fallback
  };
  vectorizationStatus: VectorizationStatus;
  // Birth chart data
  planets?: any[];
  houses?: any[];
  aspects?: any[];
  elements?: any;
  modalities?: any;
  quadrants?: any;
  patterns?: any;
}
```

#### Fetch Existing Analysis (No Workflow)

```typescript
// POST /fetchAnalysis
// Request: { userId: string }
// Response: ChartAnalysisResponse
```

### Data Models for Birth Charts

#### BasicAnalysis

```typescript
interface BasicAnalysis {
  overview: string;
  dominance: {
    elements: { interpretation: string };
    modalities: { interpretation: string };
    quadrants: { interpretation: string };
    patterns: { interpretation: string };
    planetary: { interpretation: string };
  };
  planets: {
    [planetName: string]: {
      interpretation: string;
      description: string;
    };
  };
}
```

#### BroadCategoryAnalyses (360Â° Analysis)

```typescript
interface BroadCategoryAnalysisItem {
  categoryName?: string;
  isCore?: boolean;
  overview?: string;
  subtopics?: {
    [subtopicName: string]: {
      analysis?: string;
      keyAspects?: string[];
      energyPattern?: string;
    };
  };
  editedSubtopics?: {
    [subtopicName: string]: string;  // Prefer this when rendering
  };
  tensionFlow?: {
    quadrant?: string;
    supportDensity?: number;
    challengeDensity?: number;
    polarityRatio?: number;
    totalAspects?: number;
    supportAspects?: number;
    challengeAspects?: number;
    keystoneAspects?: any[];
    description?: string;
  };
  synthesis?: string;
  editorialComplete?: boolean;
}

// Category keys
type CategoryKey =
  | 'PERSONALITY_IDENTITY'
  | 'EMOTIONAL_FOUNDATIONS_HOME'
  | 'RELATIONSHIPS_SOCIAL'
  | 'CAREER_PURPOSE_PUBLIC_IMAGE'
  | 'UNCONSCIOUS_SPIRITUALITY'
  | 'COMMUNICATION_BELIEFS';
```

### Web Implementation Notes

#### Polling Pattern with Cleanup

```typescript
function useChartAnalysis(userId: string) {
  const [status, setStatus] = useState<AnalysisWorkflowResponse | null>(null);
  const [isPolling, setIsPolling] = useState(false);
  const pollingRef = useRef<NodeJS.Timeout | null>(null);

  const startAnalysis = async () => {
    const response = await chartsApi.startFullAnalysis(userId);
    setStatus(response);

    if (!response.completed) {
      setIsPolling(true);
      pollStatus(response.workflowId);
    }
  };

  const pollStatus = (workflowId: string) => {
    pollingRef.current = setInterval(async () => {
      try {
        const response = await chartsApi.pollAnalysisStatus(userId, workflowId);
        setStatus(response);

        if (response.completed) {
          clearInterval(pollingRef.current!);
          setIsPolling(false);
          // Fetch complete data
          const data = await chartsApi.getCompleteAnalysisData(userId, workflowId);
          // Update store
        }
      } catch (error) {
        clearInterval(pollingRef.current!);
        setIsPolling(false);
      }
    }, 3000); // Poll every 3 seconds
  };

  // Cleanup on unmount
  useEffect(() => {
    return () => {
      if (pollingRef.current) {
        clearInterval(pollingRef.current);
      }
    };
  }, []);

  return { status, isPolling, startAnalysis };
}
```

#### SVG Birth Chart Wheel Rendering

```typescript
// Key components for chart wheel
interface ChartWheelProps {
  planets: BackendPlanet[];
  houses: BackendHouse[];
  aspects: BackendAspect[];
  ascendant: number;
  midheaven: number;
}

function ChartWheel({ planets, houses, aspects, ascendant, midheaven }: ChartWheelProps) {
  const svgRef = useRef<SVGSVGElement>(null);

  // Circle dimensions
  const outerRadius = 200;
  const signRingWidth = 30;
  const houseRingWidth = 40;
  const planetRingRadius = 120;
  const aspectCircleRadius = 80;

  // Zodiac signs (30Â° each, starting from Aries at 0Â°)
  const zodiacSigns = ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo',
                       'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces'];

  // Calculate position from degree
  const degreeToPosition = (degree: number, radius: number) => {
    // Adjust for Ascendant at left (9 o'clock position)
    const adjustedDegree = degree - ascendant + 180;
    const radian = (adjustedDegree * Math.PI) / 180;
    return {
      x: Math.cos(radian) * radius,
      y: Math.sin(radian) * radius,
    };
  };

  return (
    <svg ref={svgRef} viewBox="-250 -250 500 500">
      {/* Zodiac sign ring */}
      <g className="zodiac-ring">
        {zodiacSigns.map((sign, index) => (
          <ZodiacSegment
            key={sign}
            sign={sign}
            startDegree={index * 30}
            innerRadius={outerRadius - signRingWidth}
            outerRadius={outerRadius}
            ascendant={ascendant}
          />
        ))}
      </g>

      {/* House divisions */}
      <g className="houses">
        {houses.map((house) => (
          <HouseLine
            key={house.house}
            degree={house.degree}
            ascendant={ascendant}
            radius={outerRadius - signRingWidth}
          />
        ))}
      </g>

      {/* Planet positions */}
      <g className="planets">
        {planets.map((planet) => (
          <PlanetMarker
            key={planet.name}
            planet={planet}
            position={degreeToPosition(planet.full_degree, planetRingRadius)}
          />
        ))}
      </g>

      {/* Aspect lines */}
      <g className="aspects">
        {aspects.map((aspect, index) => (
          <AspectLine
            key={index}
            aspect={aspect}
            planet1Pos={degreeToPosition(aspect.aspectingPlanetDegree, aspectCircleRadius)}
            planet2Pos={degreeToPosition(aspect.aspectedPlanetDegree, aspectCircleRadius)}
          />
        ))}
      </g>
    </svg>
  );
}
```

#### Progressive Disclosure UI

```typescript
function ChartAnalysisView({ userId }: { userId: string }) {
  const { analysisWorkflowState } = useStore();
  const { status, isPolling } = useChartAnalysis(userId);

  const progress = status?.failures
    ? Math.round((status.failures.completedTasks / status.failures.totalTasks) * 100)
    : 0;

  return (
    <div>
      {/* Overview Tab - Always available after user creation */}
      <Tab label="Overview" disabled={!analysisWorkflowState.hasOverview}>
        <OverviewContent />
      </Tab>

      {/* Planets Tab - Available with overview */}
      <Tab label="Planets" disabled={!analysisWorkflowState.hasOverview}>
        <PlanetsContent />
      </Tab>

      {/* 360Â° Analysis - Shows progress while generating */}
      <Tab label="360Â° Analysis">
        {isPolling ? (
          <AnalysisProgress progress={progress} />
        ) : analysisWorkflowState.hasFullAnalysis ? (
          <FullAnalysisContent />
        ) : (
          <StartAnalysisButton onClick={startAnalysis} />
        )}
      </Tab>

      {/* Chat - Locked until 360Â° complete */}
      <Tab
        label="Ask Stellium"
        disabled={!analysisWorkflowState.hasFullAnalysis}
        lockedMessage="Complete 360Â° Analysis to unlock chat"
      >
        <ChartChat userId={userId} />
      </Tab>
    </div>
  );
}
```

---

## 6. Core Flow 3: Relationship Analysis

### Flow Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚RelationshipsScr  â”‚â”€â”€â”€â–¶â”‚CreateRelationshipScrâ”‚â”€â”€â”€â–¶â”‚RelationshipAnalysisSc â”‚
â”‚ (list view)      â”‚    â”‚ (select 2 people)   â”‚    â”‚      (5 tabs)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                            â–¼
                                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                   â”‚  CategoryDetailScr    â”‚
                                                   â”‚  (cluster deep-dive)  â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5-Cluster Scoring System

The relationship analysis uses a sophisticated 5-cluster scoring system:

| Cluster | Description | Key Aspects |
|---------|-------------|-------------|
| **Harmony** | Overall compatibility and ease | Venus aspects, trines, sextiles |
| **Passion** | Sexual chemistry and attraction | Mars aspects, 5th/8th house |
| **Connection** | Emotional and mental bonding | Moon aspects, Mercury aspects |
| **Stability** | Long-term potential | Saturn aspects, 4th/10th house |
| **Growth** | Transformative potential | Pluto aspects, North Node |

### Screen: RelationshipsScreen

**Purpose**: Display list of user's relationships (composite charts)

**Features**:
- List of created relationships
- "Add Relationship" floating button
- Navigation to analysis view

### Screen: CreateRelationshipScreen

**Purpose**: Select two people to analyze

**Two Tabs**:
1. **Guest Users Tab**: List of user's added guests
2. **Celebrities Tab**: Celebrity database with search

**Flow**:
1. Select first person
2. Select second person
3. Click "Create Relationship"
4. System calculates scores (2-5 seconds)

### Screen: RelationshipAnalysisScreen

**Tab Structure**:

| Tab | Content |
|-----|---------|
| **Scores** | 5-cluster scores with radar chart, overall tier |
| **Overview** | Initial AI overview of relationship dynamics |
| **Charts** | Synastry wheel, Composite wheel (sub-tabs) |
| **360Â° Analysis** | Full cluster analysis (Synastry + Composite panels) |
| **Ask Stellium** | Chat about relationship (locked until analysis complete) |

### APIs Used

#### Enhanced Relationship Analysis (Fast Scoring)

```typescript
// POST /enhanced-relationship-analysis
// Request:
interface EnhancedRelationshipRequest {
  userIdA: string;
  userIdB: string;
  ownerUserId?: string;
  celebRelationship?: boolean;
}

// Response:
interface EnhancedRelationshipAnalysisResponse {
  success: boolean;
  compositeChartId: string;
  userA: { id: string; name: string };
  userB: { id: string; name: string };

  // 5-Cluster Scoring
  clusters: {
    Harmony: ClusterMetrics;
    Passion: ClusterMetrics;
    Connection: ClusterMetrics;
    Stability: ClusterMetrics;
    Growth: ClusterMetrics;
  };
  overall: OverallAnalysis;
  scoredItems: ClusterScoredItem[];

  // Initial overview
  initialOverview: string | null;

  // Raw data
  compositeChart: CompositeChart;
  synastryAspects: SynastryAspect[];
  synastryHousePlacements: SynastryHousePlacements;

  status: 'scores_calculated';

  metadata: {
    processingTime: string;
    clustersAnalyzed: number;
    totalScoredItems: number;
    workflowType: 'direct-cluster-scoring';
    version: string;
    isCelebrityRelationship: boolean;
    initialOverviewGenerated: boolean;
  };
}
```

#### Cluster Metrics Structure

```typescript
interface ClusterMetrics {
  score: number;                // Normalized 0-100
  rawScore: number;
  supportPct: number;           // Positive contribution %
  challengePct: number;         // Negative contribution %
  heatPct: number;             // Average intensity %
  activityPct: number;         // Connection activity %
  sparkElements: number;        // Count of sparks
  quadrant: 'Easy-going' | 'Dynamic' | 'Hot-button' | 'Flat';
  keystoneAspects: KeystoneAspect[];  // Top 5 most impactful
}

interface OverallAnalysis {
  score: number;                // Weighted overall (0-100)
  formula: string;
  dominantCluster: string;
  challengeCluster: string;
  profile: string;              // e.g., "Harmonious with Dynamic Passion"
  tier: string;                 // Thriving, Flourishing, Emerging, Building, Developing
  strengthClusters: string[];   // Clusters > 70
  growthClusters: string[];     // Clusters < 50
  quadrantAnalytics: {
    distribution: Record<string, number>;
    entropy: number;
    dominantQuadrant: string;
    uniformity: string;
  };
  keystoneAspects: KeystoneAspect[];
}
```

#### Scored Items (Aspect Details)

```typescript
interface ClusterScoredItem {
  id: string;
  source: 'synastry' | 'composite' | 'synastryHousePlacement' | 'compositeHousePlacement';
  type: 'aspect' | 'housePlacement';
  description: string;

  clusterContributions: ClusterContribution[];

  // Astrological details
  aspect?: string;
  orb?: number;
  planet1?: string;
  planet2?: string;
  planet1Sign?: string;
  planet2Sign?: string;
  planet1House?: number;
  planet2House?: number;
  pairKey?: string;
  planet?: string;
  house?: number;
  sign?: string;
  direction?: 'A->B' | 'B->A' | 'composite';

  code: string;
  overallCentrality: number;
  maxStarRating: number;
}

interface ClusterContribution {
  cluster: 'Harmony' | 'Passion' | 'Connection' | 'Stability' | 'Growth';
  score: number;
  weight: number;
  intensity: number;
  valence: 1 | -1 | 0;
  centrality: number;
  spark: boolean;
  sparkType?: 'sexual' | 'emotional' | 'transformative' | 'karmic';
  isKeystone: boolean;
  keystoneRank?: number;
  starRating: 0 | 1 | 2 | 3 | 4 | 5;
}
```

#### Start Full Relationship Analysis (Long-Running)

```typescript
// POST /workflow/relationship/start
// Request: { compositeChartId: string; immediate?: boolean }
interface RelationshipWorkflowStartResponse {
  success: boolean;
  workflowId?: string;
  message?: string;
  error?: string;
}
```

#### Poll Relationship Workflow Status

```typescript
// POST /workflow/relationship/status
// Request: { compositeChartId: string }
interface RelationshipWorkflowStatusResponse {
  success: boolean;
  workflowId: string;
  compositeChartId: string;
  status: 'in_progress' | 'completed' | 'completed_with_failures' | 'failed' | 'paused_after_scores' | 'unknown';
  completed: boolean;
  phase: 'running' | 'complete' | 'paused';
  stepFunctionStatus: string;
  startedAt?: string;
  completedAt?: string;
  executionArn: string;
  message: string;
}
```

#### Fetch Relationship Analysis

```typescript
// POST /fetchRelationshipAnalysis
// Request: { compositeChartId: string }
interface RelationshipAnalysisResponse {
  clusterAnalysis?: {
    clusters: { Harmony, Passion, Connection, Stability, Growth: ClusterMetrics };
  };
  overall?: OverallAnalysis;
  completeAnalysis?: Record<string, ClusterAnalysis>;
  holisticOverview?: string;
  initialOverview?: string;
  clusterScoring?: ClusterScoring;  // Legacy
  synastryAspects?: SynastryAspect[];
  synastryHousePlacements?: SynastryHousePlacements;
  compositeChart?: CompositeChart;
  userA_name?: string;
  userB_name?: string;
}
```

#### Get User's Composite Charts

```typescript
// POST /getUserCompositeCharts
// Request: { ownerUserId: string }
// Response: UserCompositeChart[]

interface UserCompositeChart {
  _id: string;
  userA_name: string;
  userB_name: string;
  userA_dateOfBirth: string;
  userB_dateOfBirth: string;
  createdAt: string;
  synastryAspects?: SynastryAspect[];
  synastryHousePlacements?: SynastryHousePlacements;
  compositeChart?: CompositeChart;
  userA_id?: string;
  userB_id?: string;
  isCelebrityRelationship?: boolean;
  ownerUserId?: string;
  clusterScoring?: ClusterScoring;
  completeAnalysis?: Record<string, ClusterAnalysis>;
  initialOverview?: string;
  relationshipAnalysisStatus?: RelationshipAnalysisStatus;
}
```

### Web Implementation Notes

#### Radar Chart for 5-Cluster Scores

```typescript
import { ResponsiveRadar } from '@nivo/radar';

interface ClusterRadarChartProps {
  clusters: {
    Harmony: ClusterMetrics;
    Passion: ClusterMetrics;
    Connection: ClusterMetrics;
    Stability: ClusterMetrics;
    Growth: ClusterMetrics;
  };
}

function ClusterRadarChart({ clusters }: ClusterRadarChartProps) {
  const data = [
    {
      cluster: 'Harmony',
      score: clusters.Harmony.score,
    },
    {
      cluster: 'Passion',
      score: clusters.Passion.score,
    },
    {
      cluster: 'Connection',
      score: clusters.Connection.score,
    },
    {
      cluster: 'Stability',
      score: clusters.Stability.score,
    },
    {
      cluster: 'Growth',
      score: clusters.Growth.score,
    },
  ];

  return (
    <ResponsiveRadar
      data={data}
      keys={['score']}
      indexBy="cluster"
      maxValue={100}
      margin={{ top: 70, right: 80, bottom: 40, left: 80 }}
      borderColor={{ from: 'color' }}
      gridLabelOffset={36}
      dotSize={10}
      dotColor={{ theme: 'background' }}
      dotBorderWidth={2}
      colors={{ scheme: 'nivo' }}
      fillOpacity={0.25}
      blendMode="multiply"
    />
  );
}
```

#### Relationship Creation Flow

```typescript
function CreateRelationshipPage() {
  const [selectedPersonA, setSelectedPersonA] = useState<User | null>(null);
  const [selectedPersonB, setSelectedPersonB] = useState<User | null>(null);
  const [isCreating, setIsCreating] = useState(false);
  const navigate = useNavigate();

  const handleCreate = async () => {
    if (!selectedPersonA || !selectedPersonB) return;

    setIsCreating(true);
    try {
      // Fast scoring (2-5 seconds)
      const response = await relationshipsApi.enhancedRelationshipAnalysis(
        selectedPersonA.id,
        selectedPersonB.id,
        currentUserId,
        false // not celebrity relationship
      );

      // Navigate to analysis screen with data
      navigate(`/relationships/${response.compositeChartId}`, {
        state: { initialData: response }
      });
    } catch (error) {
      // Handle error
    } finally {
      setIsCreating(false);
    }
  };

  return (
    <div>
      <Tabs>
        <Tab label="Your Charts">
          <PersonSelector
            people={guestSubjects}
            selectedA={selectedPersonA}
            selectedB={selectedPersonB}
            onSelectA={setSelectedPersonA}
            onSelectB={setSelectedPersonB}
          />
        </Tab>
        <Tab label="Celebrities">
          <CelebritySelector
            selectedA={selectedPersonA}
            selectedB={selectedPersonB}
            onSelectA={setSelectedPersonA}
            onSelectB={setSelectedPersonB}
          />
        </Tab>
      </Tabs>

      <Button
        onClick={handleCreate}
        disabled={!selectedPersonA || !selectedPersonB || isCreating}
        loading={isCreating}
      >
        Create Relationship
      </Button>
    </div>
  );
}
```

---

## 7. Core Flow 4: Horoscope Generation

### Flow Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HoroscopeScreen â”‚â”€â”€â”€â–¶â”‚TransitSelectionScreenâ”‚â”€â”€â”€â–¶â”‚ CustomHoroscopeScreen â”‚
â”‚ (daily view)    â”‚    â”‚  (pick transits)     â”‚    â”‚    (generated)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen: HoroscopeScreen

**Purpose**: Display user's horoscope with period selection

**Features**:
- Period tabs: Today, This Week, This Month
- Transit windows display
- "Select Transits" button for custom horoscope
- Credit unlock flow for premium periods

### Screen: TransitSelectionScreen

**Purpose**: Let user select specific transits for custom horoscope

**Features**:
- Multi-select list of active transits
- Transit intensity indicators
- "Generate Custom Horoscope" button

### Screen: CustomHoroscopeScreen

**Purpose**: Display generated custom horoscope

**Features**:
- Interpretation text
- List of included transits
- Referenced natal chart elements
- "Create New Custom Horoscope" button

### APIs Used

#### Get Daily Horoscope

```typescript
// POST /users/{userId}/horoscope/daily
// Request: { startDate: string }  // "YYYY-MM-DD"
interface HoroscopeResponse {
  success: boolean;
  horoscope: {
    text?: string;
    interpretation?: string;
    startDate: string;
    endDate: string;
    keyTransits?: KeyTransit[];
    analysis?: {
      keyThemes?: KeyTheme[];
    };
  };
}

interface KeyTransit {
  transitingPlanet: string;
  aspect: string;
  targetPlanet: string;
  exactDate: string;
}
```

#### Get Weekly Horoscope

```typescript
// POST /users/{userId}/horoscope/weekly
// Request: { startDate: string }
// Response: HoroscopeResponse
```

#### Get Monthly Horoscope

```typescript
// POST /users/{userId}/horoscope/monthly
// Request: { startDate: string }
// Response: HoroscopeResponse
```

#### Get Transit Windows

```typescript
// POST /getTransitWindows
// Request: { userId: string; from?: string; to?: string }
interface TransitWindowsResponse {
  transitEvents: TransitEvent[];
  transitToTransitEvents?: TransitEvent[];
  dateRange?: {
    start: string;
    end: string;
  };
}

interface TransitEvent {
  id?: string;
  type: 'transit-to-natal' | 'transit-to-transit' | 'moon-phase';
  transitingPlanet: string;
  targetPlanet?: string;
  aspect: string;
  start: string;   // Full astronomical start
  end: string;     // Full astronomical end
  exact?: string;
  description?: string;
  transitingSign?: string;
  targetSign?: string;
  transitingHouse?: number;
  targetHouse?: number;
  priority?: number;
  isRetrograde?: boolean;
  isExactInRange?: boolean;
  startsBeforeRequest?: boolean;
  endsAfterRequest?: boolean;
  orbAtRequestStart?: number;
  orbAtRequestEnd?: number;
}
```

#### Generate Custom Horoscope

```typescript
// POST /users/{userId}/horoscope/custom
// Request:
interface CustomHoroscopeRequest {
  query?: string;                      // Optional user question
  selectedTransits?: TransitEvent[];   // Selected transit events
}

// Response:
interface CustomHoroscopeResponse {
  success: boolean;
  horoscope: {
    userId: string;
    period: 'custom' | 'daily' | 'weekly' | 'monthly';
    startDate: string;
    endDate: string;
    customTransitEvents: TransitEvent[];
    interpretation: string;
    referencedCodes?: string[];
    userPrompt?: string;
    generatedAt: string;
    requestHash: string;
    metadata: {
      hasKnownBirthTime: boolean;
      transitEventCount: number;
      mode: 'custom' | 'chat' | 'hybrid';
    };
  };
  cached: boolean;
}
```

#### Check Unlock Status

```typescript
// POST /users/{userId}/horoscope/unlock-status
// Request: { period: 'daily' | 'weekly'; startDate: string }
interface UnlockStatusResponse {
  success: boolean;
  isUnlocked: boolean;
  period: 'daily' | 'weekly';
  startDate: string;
  endDate: string;
}
```

#### Unlock Horoscope (Credit Deduction)

```typescript
// POST /users/{userId}/horoscope/unlock
// Request: { period: 'daily' | 'weekly'; startDate: string }
interface UnlockHoroscopeResponse {
  success: boolean;
  alreadyUnlocked: boolean;
  creditsCharged: number;
  period: 'daily' | 'weekly';
  startDate: string;
  endDate: string;
}
```

### Web Implementation Notes

#### Date Range Handling

```typescript
function getDateRangeForPeriod(period: 'today' | 'thisWeek' | 'thisMonth'): { start: string; end: string } {
  const now = new Date();

  switch (period) {
    case 'today':
      return {
        start: formatDate(now),
        end: formatDate(now),
      };

    case 'thisWeek':
      const weekStart = startOfWeek(now, { weekStartsOn: 1 }); // Monday
      const weekEnd = endOfWeek(now, { weekStartsOn: 1 });
      return {
        start: formatDate(weekStart),
        end: formatDate(weekEnd),
      };

    case 'thisMonth':
      const monthStart = startOfMonth(now);
      const monthEnd = endOfMonth(now);
      return {
        start: formatDate(monthStart),
        end: formatDate(monthEnd),
      };
  }
}

function formatDate(date: Date): string {
  return date.toISOString().split('T')[0]; // "YYYY-MM-DD"
}
```

#### Transit Selection Component

```typescript
function TransitSelector({
  transits,
  selectedIds,
  onToggle
}: {
  transits: TransitEvent[];
  selectedIds: Set<string>;
  onToggle: (id: string) => void;
}) {
  // Group transits by type
  const natalTransits = transits.filter(t => t.type === 'transit-to-natal');
  const transitToTransits = transits.filter(t => t.type === 'transit-to-transit');
  const moonPhases = transits.filter(t => t.type === 'moon-phase');

  return (
    <div>
      <Section title="Natal Transits">
        {natalTransits.map(transit => (
          <TransitItem
            key={transit.id}
            transit={transit}
            selected={selectedIds.has(transit.id!)}
            onToggle={() => onToggle(transit.id!)}
          />
        ))}
      </Section>

      <Section title="Planetary Transits">
        {transitToTransits.map(transit => (
          <TransitItem
            key={transit.id}
            transit={transit}
            selected={selectedIds.has(transit.id!)}
            onToggle={() => onToggle(transit.id!)}
          />
        ))}
      </Section>

      <Section title="Moon Phases">
        {moonPhases.map(transit => (
          <TransitItem
            key={transit.id}
            transit={transit}
            selected={selectedIds.has(transit.id!)}
            onToggle={() => onToggle(transit.id!)}
          />
        ))}
      </Section>
    </div>
  );
}
```

#### Horoscope Loading with Extended Timeouts

```typescript
function useHoroscope(userId: string, period: 'today' | 'thisWeek' | 'thisMonth') {
  const [horoscope, setHoroscope] = useState<HoroscopeResponse | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [loadingState, setLoadingState] = useState<'initial' | 'extended' | null>(null);

  const fetchHoroscope = async () => {
    setLoading(true);
    setError(null);
    setLoadingState('initial');

    // Show extended loading message after 10 seconds
    const extendedTimeout = setTimeout(() => {
      setLoadingState('extended');
    }, 10000);

    try {
      const { start } = getDateRangeForPeriod(period);
      let response: HoroscopeResponse;

      switch (period) {
        case 'today':
          response = await horoscopesApi.getDailyHoroscope(userId, start);
          break;
        case 'thisWeek':
          response = await horoscopesApi.getWeeklyHoroscope(userId, start);
          break;
        case 'thisMonth':
          response = await horoscopesApi.getMonthlyHoroscope(userId, start);
          break;
      }

      setHoroscope(response);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to load horoscope');
    } finally {
      clearTimeout(extendedTimeout);
      setLoading(false);
      setLoadingState(null);
    }
  };

  return {
    horoscope,
    loading,
    error,
    loadingState,
    refetch: fetchHoroscope
  };
}
```

---

## 8. Core Flow 5: AI Chat Interactions

### Chat Contexts

The app supports three chat contexts, each requiring different prerequisites:

| Context | Prerequisite | API Endpoint |
|---------|--------------|--------------|
| **Birth Chart Chat** | 360Â° Analysis complete | `/users/{userId}/birthchart/enhanced-chat` |
| **Relationship Chat** | Relationship analysis complete | `/relationships/{compositeChartId}/enhanced-chat` |
| **Horoscope Chat** | Custom horoscope generated | (Embedded in horoscope flow) |

### Enhanced Chat Features

All chat contexts support:
- **Element Selection**: Users can select specific chart elements to focus the conversation
- **Referenced Codes**: AI response includes codes of natal chart elements it referenced
- **Mode Classification**: Each message is tagged with mode ('chat', 'custom', 'hybrid')

### APIs Used

#### Enhanced Chat for Birth Chart

```typescript
// POST /users/{userId}/birthchart/enhanced-chat
// Request:
interface BirthChartChatRequest {
  query?: string;
  selectedAspects?: BirthChartElement[];
}

// Response:
interface BirthChartChatResponse {
  success: boolean;
  answer: string;
  referencedCodes?: string[];
  chatHistoryResult: any;
  mode: 'chat' | 'custom' | 'hybrid';
}

// BirthChartElement types
interface BirthChartPosition {
  type: 'position';
  planet: string;
  sign: string;
  house: number | null;
  degree: number;
  isRetrograde?: boolean;
  description: string;
}

interface BirthChartAspect {
  type: 'aspect';
  planet1: string;
  planet2: string;
  aspectType: string;
  orb: number;
  planet1Sign: string;
  planet2Sign: string;
  planet1House: number | null;
  planet2House: number | null;
  description: string;
}

type BirthChartElement = BirthChartPosition | BirthChartAspect;
```

#### Enhanced Chat for Relationships

```typescript
// POST /relationships/{compositeChartId}/enhanced-chat
// Request:
interface RelationshipChatRequest {
  query?: string;
  scoredItems?: ClusterScoredItem[];
}

// Response:
interface RelationshipChatResponse {
  success: boolean;
  analysis?: string;
  answer?: string;  // Compatibility field
  referencedCodes?: string[];
  mode?: string;
}
```

#### Fetch Chat History

```typescript
// Birth Chart History
// GET /users/{userId}/birthchart/chat-history?limit={limit}
interface ChatHistoryResponse {
  success: boolean;
  chatHistory: Array<{
    role: 'user' | 'assistant';
    content: string;
    timestamp: string;
    metadata?: {
      mode?: 'chat' | 'custom' | 'hybrid';
      selectedElements?: BirthChartElement[] | ClusterScoredItem[];
      referencedCodes?: string[];
      elementCount?: number;
    };
  }>;
  messageCount: number;
}

// Relationship History
// GET /relationships/{compositeChartId}/chat-history?limit={limit}
// Response: Same structure as above
```

### Web Implementation Notes

#### Chat Component with Element Selection

```typescript
interface ChatMessage {
  id: string;
  type: 'user' | 'assistant' | 'error';
  content: string;
  timestamp: Date;
  mode?: 'chat' | 'custom' | 'hybrid';
  selectedElements?: BirthChartElement[];
  referencedElements?: BirthChartElement[];
  loading?: boolean;
}

function BirthChartChat({ userId }: { userId: string }) {
  const [messages, setMessages] = useState<ChatMessage[]>([]);
  const [inputValue, setInputValue] = useState('');
  const [selectedElements, setSelectedElements] = useState<BirthChartElement[]>([]);
  const [isSending, setIsSending] = useState(false);

  // Load chat history on mount
  useEffect(() => {
    loadChatHistory();
  }, [userId]);

  const loadChatHistory = async () => {
    const response = await chartsApi.fetchBirthChartEnhancedChatHistory(userId, 50);
    const converted = response.chatHistory.map(msg => ({
      id: crypto.randomUUID(),
      type: msg.role === 'user' ? 'user' : 'assistant',
      content: msg.content,
      timestamp: new Date(msg.timestamp),
      mode: msg.metadata?.mode,
      selectedElements: msg.metadata?.selectedElements,
      referencedElements: msg.metadata?.referencedCodes
        ? parseReferencedCodes(msg.metadata.referencedCodes)
        : undefined,
    }));
    setMessages(converted);
  };

  const sendMessage = async () => {
    if (!inputValue.trim() && selectedElements.length === 0) return;

    const userMessage: ChatMessage = {
      id: crypto.randomUUID(),
      type: 'user',
      content: inputValue,
      timestamp: new Date(),
      selectedElements: selectedElements.length > 0 ? [...selectedElements] : undefined,
    };

    setMessages(prev => [...prev, userMessage]);
    setInputValue('');
    setIsSending(true);

    // Add loading message
    const loadingId = crypto.randomUUID();
    setMessages(prev => [...prev, {
      id: loadingId,
      type: 'assistant',
      content: '',
      timestamp: new Date(),
      loading: true,
    }]);

    try {
      const response = await chartsApi.enhancedChatForBirthChart(userId, {
        query: inputValue.trim() || undefined,
        selectedAspects: selectedElements.length > 0 ? selectedElements : undefined,
      });

      // Replace loading with actual response
      setMessages(prev => prev.map(msg =>
        msg.id === loadingId
          ? {
              ...msg,
              content: response.answer,
              mode: response.mode,
              referencedElements: response.referencedCodes
                ? parseReferencedCodes(response.referencedCodes)
                : undefined,
              loading: false,
            }
          : msg
      ));
    } catch (error) {
      setMessages(prev => prev.map(msg =>
        msg.id === loadingId
          ? {
              ...msg,
              type: 'error',
              content: 'Failed to get response. Please try again.',
              loading: false,
            }
          : msg
      ));
    } finally {
      setIsSending(false);
      setSelectedElements([]);
    }
  };

  return (
    <div className="chat-container">
      {/* Element Selection Panel */}
      <ElementSelector
        elements={availableElements}
        selected={selectedElements}
        onToggle={handleElementToggle}
      />

      {/* Message List */}
      <div className="message-list">
        {messages.map(msg => (
          <ChatMessageBubble
            key={msg.id}
            message={msg}
          />
        ))}
      </div>

      {/* Input Area */}
      <div className="input-area">
        <input
          value={inputValue}
          onChange={(e) => setInputValue(e.target.value)}
          placeholder={selectedElements.length > 0
            ? "Ask about selected elements..."
            : "Ask about your birth chart..."
          }
          onKeyDown={(e) => e.key === 'Enter' && sendMessage()}
        />
        <button onClick={sendMessage} disabled={isSending}>
          Send
        </button>
      </div>
    </div>
  );
}
```

#### Element Selection Chips

```typescript
function ElementSelector({
  elements,
  selected,
  onToggle
}: {
  elements: BirthChartElement[];
  selected: BirthChartElement[];
  onToggle: (element: BirthChartElement) => void;
}) {
  const positions = elements.filter(e => e.type === 'position');
  const aspects = elements.filter(e => e.type === 'aspect');

  const isSelected = (element: BirthChartElement) =>
    selected.some(s =>
      s.type === 'position' && element.type === 'position'
        ? s.planet === element.planet
        : s.type === 'aspect' && element.type === 'aspect'
          ? s.planet1 === element.planet1 && s.planet2 === element.planet2
          : false
    );

  return (
    <div className="element-selector">
      <div className="section">
        <h4>Planetary Positions</h4>
        <div className="chip-grid">
          {positions.map((pos) => (
            <Chip
              key={pos.planet}
              label={`${pos.planet} in ${pos.sign}`}
              selected={isSelected(pos)}
              onClick={() => onToggle(pos)}
            />
          ))}
        </div>
      </div>

      <div className="section">
        <h4>Aspects</h4>
        <div className="chip-grid">
          {aspects.map((asp) => (
            <Chip
              key={`${asp.planet1}-${asp.planet2}`}
              label={`${asp.planet1} ${asp.aspectType} ${asp.planet2}`}
              selected={isSelected(asp)}
              onClick={() => onToggle(asp)}
            />
          ))}
        </div>
      </div>
    </div>
  );
}
```

---

## 9. Supporting Flows

### Flow 6: Guest/Subject Management

#### Adding Guest Charts

**Screen**: GuestOnboardingScreen (same wizard as user onboarding)

```typescript
// POST /createGuestSubject
interface CreateGuestSubjectRequest {
  ownerUserId: string;
  firstName: string;
  lastName: string;
  dateOfBirth: string;
  placeOfBirth: string;
  time: string;
  lat?: number;
  lon?: number;
  tzone?: number;
  gender?: string;
}

// POST /createGuestSubjectUnknownTime
interface CreateGuestSubjectUnknownTimeRequest {
  ownerUserId: string;
  firstName: string;
  lastName: string;
  gender: string;
  placeOfBirth: string;
  dateOfBirth: string;
  lat: number;
  lon: number;
  tzone: number;
}
```

#### Get User's Subjects (with Pagination)

```typescript
// POST /getUserSubjects
interface GetUserSubjectsRequest {
  ownerUserId: string;
  usePagination?: boolean;
  page?: number;
  limit?: number;
  search?: string;
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
}

interface PaginatedUserSubjectsResponse {
  success: boolean;
  data: SubjectDocument[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
    hasNext: boolean;
    hasPrev: boolean;
  };
  search?: {
    query: string;
    resultsCount: number;
  };
}
```

### Flow 7: Celebrity Features

#### Celebrity Search and Browse

```typescript
// POST /getCelebs (with pagination)
interface GetCelebsRequest {
  usePagination?: boolean;
  page?: number;
  limit?: number;
  search?: string;
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
}

interface PaginatedCelebritiesResponse {
  success: boolean;
  data: Celebrity[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
    hasNext: boolean;
    hasPrev: boolean;
  };
  search?: {
    query: string;
    resultsCount: number;
  };
}

interface Celebrity {
  _id: string;
  firstName: string;
  lastName: string;
  dateOfBirth: string;
  placeOfBirth: string;
  time?: string;
  gender?: 'male' | 'female' | 'other';
  totalOffsetHours?: number;
  birthChart?: any;
  isCelebrity?: boolean;
  isReadOnly?: boolean;
}
```

#### Celebrity Chart Analysis

```typescript
// POST /getCelebrityChartAnalysis
// Request: { celebrityId: string }
// Response: Same as ChartAnalysisResponse
```

#### Celebrity Compatibility

```typescript
// POST /analyzeCelebrityCompatibility
interface CelebrityRelationshipRequest {
  userId: string;
  celebrityId: string;
}

interface CelebrityCompatibilityResponse {
  celebrity: Celebrity;
  user: any;
  compatibilityScore: number;
  analysis: string;
  strengths: string[];
  challenges: string[];
  synastryAspects: any[];
}
```

### Flow 8: Account & Settings

#### Subscription Management

```typescript
// GET /users/{userId}/subscription
interface GetSubscriptionStatusResponse {
  subscription: UserSubscription;
  usage: UsageMetrics;
  entitlements: SubscriptionEntitlements;
}

// POST /users/{userId}/subscription/cancel
// Response: { subscription: UserSubscription; cancelled: boolean; expiresAt: string }

// POST /users/{userId}/subscription/reactivate
// Response: { subscription: UserSubscription; reactivated: boolean }
```

#### Account Deletion

```typescript
// POST /account/delete
// Request: { userId: string }
interface DeleteAccountResponse {
  success: boolean;
  message: string;
  deletionResults: any;
  totalDeleted: number;
  firebaseAuthDeletionRequired: boolean;
  firebaseUid: string;
}
```

#### Delete Relationship

```typescript
// DELETE /relationships/{relationshipId}
// Response: { success: boolean }
```

---

## 10. Complete API Reference

### API Modules Overview

| Module | Endpoints | Primary Functions |
|--------|-----------|-------------------|
| Users | 14 | User CRUD, guest subjects, profile photos |
| Charts | 11 | Birth chart analysis, workflows, chat |
| Relationships | 12 | Composite charts, scoring, workflows, chat |
| Horoscopes | 14 | Daily/weekly/monthly, custom, transits |
| Celebrities | 14 | Browse, search, compatibility |
| Subscriptions | 12 | Status, usage, RevenueCat sync |

### Authentication

All API calls require Firebase ID token:

```typescript
// Header format
Authorization: Bearer <firebase_id_token>
Content-Type: application/json
```

### Users API

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/createUser` | Create user with known birth time |
| POST | `/createUserUnknownTime` | Create user without birth time |
| POST | `/getUser` | Get user by ID |
| POST | `/getUserByFirebaseUid` | Get user by Firebase UID |
| POST | `/getUsers` | Get all users (admin) |
| POST | `/getUserSubjects` | Get user's subjects (paginated) |
| PUT | `/users/{userId}` | Update user profile |
| DELETE | `/users/{userId}` | Delete user |
| POST | `/createGuestSubject` | Create guest with known time |
| POST | `/createGuestSubjectUnknownTime` | Create guest without time |
| POST | `/subjects/{id}/profile-photo/presigned-url` | Get upload URL |
| POST | `/subjects/{id}/profile-photo/confirm` | Confirm upload |
| DELETE | `/subjects/{id}/profile-photo` | Delete photo |
| POST | `/account/delete` | Delete account |

### Charts API

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/getBirthChartAnalysis` | Get full analysis |
| POST | `/fetchAnalysis` | Fetch existing analysis |
| POST | `/analysis/start-full` | Start 86-task workflow |
| POST | `/analysis/full-status` | Poll workflow status |
| POST | `/workflow/get-complete-data` | Get completed analysis |
| POST | `/getSubtopicAnalysis` | Generate topic analysis |
| POST | `/processBasicAnalysis` | Vectorize basic analysis |
| POST | `/processTopicAnalysis` | Vectorize topic analysis |
| POST | `/users/{id}/birthchart/enhanced-chat` | Chart chat |
| GET | `/users/{id}/birthchart/chat-history` | Chat history |

### Relationships API

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/enhanced-relationship-analysis` | Fast 5-cluster scoring |
| POST | `/workflow/relationship/start` | Start full analysis |
| POST | `/workflow/relationship/status` | Poll workflow |
| POST | `/workflow/relationship/resume` | Resume paused workflow |
| POST | `/fetchRelationshipAnalysis` | Fetch analysis |
| POST | `/getUserCompositeCharts` | Get user's relationships |
| DELETE | `/relationships/{id}` | Delete relationship |
| POST | `/chatForUserRelationship` | Legacy chat |
| POST | `/fetchUserChatRelationshipAnalysis` | Legacy history |
| POST | `/relationships/{id}/enhanced-chat` | Enhanced chat |
| GET | `/relationships/{id}/chat-history` | Chat history |

### Horoscopes API

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/users/{id}/horoscope/daily` | Get/generate daily |
| POST | `/users/{id}/horoscope/weekly` | Get/generate weekly |
| POST | `/users/{id}/horoscope/monthly` | Get/generate monthly |
| POST | `/users/{id}/horoscope/custom` | Generate custom |
| GET | `/users/{id}/horoscope/latest` | Get latest |
| POST | `/getTransitWindows` | Get transit windows |
| GET | `/users/{id}/horoscope/custom?limit=N` | Custom history |
| POST | `/users/{id}/horoscope/unlock-status` | Check unlock |
| POST | `/users/{id}/horoscope/unlock` | Unlock (credit) |

### Celebrities API

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/getCelebs` | Get celebrities (paginated) |
| POST | `/searchCelebrities` | Search with filters |
| POST | `/getCelebrity` | Get by ID |
| POST | `/getCelebritiesByProfession` | Filter by profession |
| POST | `/getCelebritiesBySign` | Filter by sign |
| POST | `/getTrendingCelebrities` | Get trending |
| POST | `/getCelebrityChartAnalysis` | Get chart analysis |
| POST | `/analyzeCelebrityCompatibility` | User-celebrity compatibility |
| POST | `/findCelebrityMatches` | Find matches for user |
| POST | `/getCelebrityRelationships` | Get relationships |
| GET | `/getCelebrityProfessions` | Get professions list |
| PUT | `/celebrities/{id}` | Update (admin) |
| DELETE | `/celebrities/{id}` | Delete (admin) |

### Subscriptions API

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/users/{id}/subscription` | Get status |
| GET | `/users/{id}/subscription/usage` | Get usage metrics |
| POST | `/users/{id}/subscription/usage` | Update usage |
| POST | `/users/{id}/subscription/usage/reset` | Reset usage |
| POST | `/users/{id}/subscription/sync-revenuecat` | Sync purchase |
| POST | `/users/{id}/subscription/validate` | Validate feature |
| POST | `/users/{id}/subscription/initialize` | Initialize new user |
| GET | `/subscription/plans` | Get available plans |
| POST | `/users/{id}/subscription/cancel` | Cancel |
| POST | `/users/{id}/subscription/reactivate` | Reactivate |
| POST | `/users/{id}/subscription/upgrade` | Upgrade tier |
| POST | `/users/{id}/subscription/downgrade` | Downgrade tier |

---

## 11. Data Models Reference

### Core User Types

```typescript
interface User {
  id: string;
  name: string;
  email?: string;
  birthYear: number;
  birthMonth: number;
  birthDay: number;
  birthHour: number;
  birthMinute: number;
  birthLocation: string;
  timezone: string;
  birthChart?: BirthChart;
  analysisStatus?: AnalysisStatus;
  profilePhotoUrl?: string;
  profilePhotoKey?: string;
  profilePhotoUpdatedAt?: Date;
  subscription?: UserSubscription;
  usage?: UsageMetrics;
  entitlements?: SubscriptionEntitlements;
}

interface SubjectDocument {
  _id: string;
  createdAt: string;
  updatedAt: string;
  kind: 'accountSelf' | 'celebrity' | 'guest';
  ownerUserId: string | null;
  isCelebrity: boolean;
  isReadOnly: boolean;
  firstName: string;
  lastName: string;
  gender?: 'male' | 'female' | 'other';
  dateOfBirth: string;
  placeOfBirth: string;
  email?: string;
  time?: string;
  birthTimeUnknown?: boolean;
  totalOffsetHours: number;
  birthChart: BirthChart;
  analysisStatus?: AnalysisStatus;
  profilePhotoUrl?: string;
  profilePhotoKey?: string;
  profilePhotoUpdatedAt?: Date;
}
```

### Birth Chart Types

```typescript
interface BirthChart {
  date: string;
  lat: number;
  lon: number;
  tzone: number;
  jdUT: number;
  planets: BackendPlanet[];
  aspects: BackendAspect[];
  houses: BackendHouse[];
  ascendant: number;
  midheaven: number;
  elements: ElementAnalysis;
  modalities: ModalityAnalysis;
  quadrants: QuadrantAnalysis;
  patterns: PatternAnalysis;
  planetaryDominance: PlanetaryDominanceAnalysis;
}

interface BackendPlanet {
  name: PlanetName;
  full_degree: number;
  norm_degree: number;
  speed: number;
  is_retro: boolean;
  sign: ZodiacSign | null;
  house: number;
  tags?: string[];
}

interface BackendAspect {
  aspectingPlanet: PlanetName;
  aspectingPlanetDegree: number;
  aspectedPlanet: PlanetName;
  aspectedPlanetDegree: number;
  aspectType: AspectType;
  orb: number;
}

interface BackendHouse {
  house: number;
  degree: number;
  sign: ZodiacSign | null;
}

type PlanetName = 'Sun' | 'Moon' | 'Mercury' | 'Venus' | 'Mars' | 'Jupiter' |
                  'Saturn' | 'Uranus' | 'Neptune' | 'Pluto' | 'Ascendant' |
                  'Midheaven' | 'Chiron' | 'Node';

type ZodiacSign = 'Aries' | 'Taurus' | 'Gemini' | 'Cancer' | 'Leo' | 'Virgo' |
                  'Libra' | 'Scorpio' | 'Sagittarius' | 'Capricorn' | 'Aquarius' | 'Pisces';

type AspectType = 'conjunction' | 'opposition' | 'trine' | 'square' | 'sextile' |
                  'quincunx' | 'semisextile' | 'semisquare' | 'sesquiquadrate';
```

### Subscription Types

```typescript
type SubscriptionTier = 'free' | 'premium' | 'pro';

interface UserSubscription {
  tier: SubscriptionTier;
  status: 'active' | 'expired' | 'cancelled' | 'trial';
  expiresAt?: string;
  renewsAt?: string;
  cancelledAt?: string;
  subscriptionAnniversary: string;
  revenueCatCustomerId?: string;
  revenueCatEntitlementId?: string;
  stripeCustomerId?: string;
  stripeSubscriptionId?: string;
}

interface UsageMetrics {
  quickChartsUsed: number;
  quickMatchesUsed: number;
  reportsUsed: number;
  chatQuestionsUsed: number;
  lastResetDate: string;
  nextResetDate: string;
  updatedAt: string;
}

interface SubscriptionEntitlements {
  canAccessWeeklyHoroscope: boolean;
  canAccessDailyHoroscope: boolean;
  canAccessMonthlyHoroscope: boolean;
  canGenerateNatalReport: boolean;
  canGenerateCompatibilityReport: boolean;
  canCreateQuickCharts: boolean;
  canCreateQuickMatches: boolean;
  canUseTransitChat: boolean;
  canUseChartChat: boolean;
  canUseRelationshipChat: boolean;
  hasUnlimitedCharts: boolean;
  hasUnlimitedMatches: boolean;
  hasUnlimitedChat: boolean;
  quickChartsLimit: number | 'unlimited';
  quickMatchesLimit: number | 'unlimited';
  reportsLimit: number;
  chatQuestionsLimit: number | 'unlimited';
}
```

### Workflow State Types

```typescript
interface WorkflowState {
  workflowId: string | null;
  userId: string | null;
  status: string | null;
  isCompleted: boolean;
  progress: number | null;
}

interface AnalysisWorkflowState {
  isPaused: boolean;
  hasOverview: boolean;
  hasFullAnalysis: boolean;
  overviewContent: string;
  analysisContent: any;
}

interface RelationshipWorkflowState {
  isPaused: boolean;
  hasScores: boolean;
  scores: { [key: string]: number };
  scoreAnalysis: { [key: string]: any };
  startedFromCreation: boolean;
  completed?: boolean;
  clusterScoring?: ClusterScoring;
  completeAnalysis?: Record<string, ClusterAnalysis>;
  workflowId?: string;
  compositeChartId?: string;
  status?: 'running' | 'completed' | 'error' | 'paused' | 'unknown';
  progress?: {
    percentage: number;
    currentPhase: string;
    currentStep?: string;
    tasksCompleted?: number;
    totalTasks?: number;
  };
  isCompleted?: boolean;
  error?: string;
  isPollingActive?: boolean;
  activeCompositeChartId?: string;
}
```

### Astrology Constants

```typescript
// Zodiac signs with symbols
const zodiacSymbols = {
  'Aries': 'â™ˆ', 'Taurus': 'â™‰', 'Gemini': 'â™Š', 'Cancer': 'â™‹',
  'Leo': 'â™Œ', 'Virgo': 'â™', 'Libra': 'â™', 'Scorpio': 'â™',
  'Sagittarius': 'â™', 'Capricorn': 'â™‘', 'Aquarius': 'â™’', 'Pisces': 'â™“',
};

// Planetary symbols
const planetarySymbols = {
  'Sun': 'â˜‰', 'Moon': 'â˜½', 'Ascendant': 'â†—', 'Mercury': 'â˜¿',
  'Venus': 'â™€', 'Mars': 'â™‚', 'Jupiter': 'â™ƒ', 'Saturn': 'â™„',
  'Uranus': 'â™…', 'Neptune': 'â™†', 'Pluto': 'â™‡',
};

// Elements and signs
const elements = {
  'Fire': ['Leo', 'Aries', 'Sagittarius'],
  'Earth': ['Taurus', 'Virgo', 'Capricorn'],
  'Air': ['Gemini', 'Libra', 'Aquarius'],
  'Water': ['Cancer', 'Scorpio', 'Pisces'],
};

// Modalities
const modalities = {
  'Cardinal': ['Aries', 'Cancer', 'Libra', 'Capricorn'],
  'Fixed': ['Taurus', 'Leo', 'Scorpio', 'Aquarius'],
  'Mutable': ['Gemini', 'Virgo', 'Sagittarius', 'Pisces'],
};

// Aspect angles
const aspects = [
  { name: 'conjunction', orb: 0 },
  { name: 'sextile', orb: 60 },
  { name: 'square', orb: 90 },
  { name: 'trine', orb: 120 },
  { name: 'quincunx', orb: 150 },
  { name: 'opposition', orb: 180 },
];

// Broad analysis categories
const BroadTopicsEnum = {
  PERSONALITY_IDENTITY: { label: 'Self-Expression and Identity', subtopics: {...} },
  EMOTIONAL_FOUNDATIONS_HOME: { label: 'Emotional Foundations and Home Life', subtopics: {...} },
  RELATIONSHIPS_SOCIAL: { label: 'Relationships and Social Connections', subtopics: {...} },
  CAREER_PURPOSE_PUBLIC_IMAGE: { label: 'Career, Purpose, and Public Image', subtopics: {...} },
  UNCONSCIOUS_SPIRITUALITY: { label: 'Unconscious Drives and Spiritual Growth', subtopics: {...} },
  COMMUNICATION_BELIEFS: { label: 'Communication, Learning, and Belief Systems', subtopics: {...} },
};
```

---

## 12. State Management for Web

### Recommended Store Structure (Zustand)

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface StoreState {
  // User & Authentication
  userData: User | null;
  userId: string;
  isAuthenticated: boolean;
  userSubscription: UserSubscription | null;
  usageMetrics: UsageMetrics | null;
  entitlements: SubscriptionEntitlements | null;

  // Birth Chart Data
  userPlanets: Planet[];
  userHouses: House[];
  userAspects: Aspect[];
  userElements: any;
  userModalities: any;
  userQuadrants: any;
  userPatterns: any;

  // Context Management
  currentUserContext: User | null;
  activeUserContext: User | null;
  previousUserContext: User | null;

  // Guest Subjects
  guestSubjects: User[];
  selectedSubject: User | null;

  // Workflow States
  creationWorkflowState: WorkflowState;
  analysisWorkflowState: AnalysisWorkflowState;
  relationshipWorkflowState: RelationshipWorkflowState;

  // UI States
  loading: boolean;
  error: string | null;
  activeTab: TabName;
  profileModalVisible: boolean;

  // Credit Modal
  insufficientCreditsModal: {
    visible: boolean;
    currentCredits: number;
    requiredCredits: number;
    onAddCreditsCallback: (() => void) | null;
  };

  // Theme
  themeMode: 'light' | 'dark' | 'system';

  // Transit & Horoscope
  transitData: TransitEvent[];
  selectedTransits: Set<string>;
  customHoroscope: any;
  horoscopeFilter: 'today' | 'thisWeek' | 'thisMonth' | 'chat';

  // Actions
  setUserData: (userData: User | null) => void;
  setWorkflowState: (workflowState: Partial<WorkflowState>) => void;
  setAnalysisState: (analysisState: Partial<AnalysisWorkflowState>) => void;
  setRelationshipWorkflowState: (state: Partial<RelationshipWorkflowState>) => void;
  setActiveUserContext: (context: User | null) => void;
  switchUserContext: (newUser: User) => void;
  navigateBack: () => void;
  clearError: () => void;
  setLoading: (loading: boolean) => void;
  showCreditModal: (current: number, required: number, callback: () => void) => void;
  hideCreditModal: () => void;
  setThemeMode: (theme: 'light' | 'dark' | 'system') => void;
  setTransitData: (data: TransitEvent[]) => void;
  toggleTransitSelection: (id: string) => void;
  setCustomHoroscope: (horoscope: any) => void;
  setHoroscopeFilter: (filter: 'today' | 'thisWeek' | 'thisMonth' | 'chat') => void;
  setGuestSubjects: (subjects: User[]) => void;
  addGuestSubject: (subject: User) => void;
  setSubscription: (subscription: UserSubscription | null) => void;
  setUsageMetrics: (usage: UsageMetrics | null) => void;
  setEntitlements: (entitlements: SubscriptionEntitlements | null) => void;
  signOut: () => Promise<void>;
}

export const useStore = create<StoreState>()(
  persist(
    (set, get) => ({
      // Initial state...
      userData: null,
      userId: '',
      isAuthenticated: false,
      // ... rest of initial state

      // Actions
      setUserData: (userData) => {
        set({
          userData,
          isAuthenticated: !!userData,
          userId: userData?.id || '',
          currentUserContext: userData,
          activeUserContext: userData,
        });
      },

      switchUserContext: (newUser) => {
        const { activeUserContext } = get();
        set({
          previousUserContext: activeUserContext,
          activeUserContext: newUser,
        });
      },

      navigateBack: () => {
        const { previousUserContext } = get();
        if (previousUserContext) {
          set({
            activeUserContext: previousUserContext,
            previousUserContext: null,
          });
        }
      },

      // ... rest of actions
    }),
    {
      name: 'stellium-storage',
      partialize: (state) => ({
        themeMode: state.themeMode,
        // Don't persist user data - comes from Firebase Auth
      }),
    }
  )
);
```

### Key Store Slices

#### User Context Management

```typescript
// Supports viewing different charts while maintaining navigation history
// currentUserContext: Always the logged-in user
// activeUserContext: Currently viewed user (can be guest or celebrity)
// previousUserContext: For back navigation

const switchUserContext = (newUser: User) => {
  const { activeUserContext } = get();
  set({
    previousUserContext: activeUserContext,
    activeUserContext: newUser,
  });
};

const navigateBack = () => {
  const { previousUserContext } = get();
  if (previousUserContext) {
    set({
      activeUserContext: previousUserContext,
      previousUserContext: null,
    });
  }
};
```

#### Transit Selection (Set-based)

```typescript
// Using Set for efficient toggle operations
selectedTransits: new Set<string>(),

toggleTransitSelection: (transitId) => set((state) => {
  const newSelected = new Set(state.selectedTransits);
  if (newSelected.has(transitId)) {
    newSelected.delete(transitId);
  } else {
    newSelected.add(transitId);
  }
  return { selectedTransits: newSelected };
}),
```

### Persistence Strategy

For web, use localStorage instead of AsyncStorage:

```typescript
import { persist, createJSONStorage } from 'zustand/middleware';

const useStore = create<StoreState>()(
  persist(
    (set, get) => ({...}),
    {
      name: 'stellium-storage',
      storage: createJSONStorage(() => localStorage),
      partialize: (state) => ({
        // Only persist theme - user data comes from Firebase
        themeMode: state.themeMode,
      }),
    }
  )
);
```

---

## 13. Web Implementation Recommendations

### Routing Structure

```typescript
// src/routes/index.tsx
import { Routes, Route, Navigate, Outlet } from 'react-router-dom';

function AppRoutes() {
  return (
    <Routes>
      {/* Public */}
      <Route path="/auth" element={<AuthPage />} />
      <Route path="/onboarding" element={<OnboardingWizard />} />

      {/* Protected App Shell */}
      <Route element={<ProtectedLayout />}>
        <Route path="/" element={<Navigate to="/horoscope" />} />

        {/* Horoscope */}
        <Route path="/horoscope" element={<HoroscopePage />} />
        <Route path="/horoscope/transits" element={<TransitSelectionPage />} />
        <Route path="/horoscope/custom" element={<CustomHoroscopePage />} />

        {/* Charts */}
        <Route path="/charts" element={<ChartSelectionPage />} />
        <Route path="/charts/:userId" element={<ChartPage />} />
        <Route path="/charts/:userId/category/:categoryKey" element={<ChartCategoryPage />} />
        <Route path="/charts/add" element={<GuestOnboardingPage />} />

        {/* Relationships */}
        <Route path="/relationships" element={<RelationshipsPage />} />
        <Route path="/relationships/create" element={<CreateRelationshipPage />} />
        <Route path="/relationships/:compositeChartId" element={<RelationshipAnalysisPage />} />
        <Route path="/relationships/:compositeChartId/category/:cluster" element={<RelationshipCategoryPage />} />

        {/* Celebrities */}
        <Route path="/celebrities" element={<CelebritiesPage />} />
        <Route path="/celebrities/:celebrityId" element={<CelebrityDetailPage />} />

        {/* Settings */}
        <Route path="/settings" element={<SettingsPage />} />
        <Route path="/settings/subscription" element={<SubscriptionPage />} />
        <Route path="/settings/credits" element={<CreditPurchasePage />} />
        <Route path="/settings/account" element={<ManageAccountPage />} />
        <Route path="/settings/delete-account" element={<DeleteAccountPage />} />
      </Route>
    </Routes>
  );
}
```

### Protected Layout Component

```typescript
function ProtectedLayout() {
  const { isAuthenticated, userData } = useStore();
  const location = useLocation();

  if (!isAuthenticated) {
    return <Navigate to="/auth" state={{ from: location }} replace />;
  }

  if (!userData?.birthChart) {
    return <Navigate to="/onboarding" replace />;
  }

  return (
    <div className="app-layout">
      <Sidebar />
      <main className="main-content">
        <Outlet />
      </main>
      <ProfileModal />
      <InsufficientCreditsModal />
    </div>
  );
}
```

### API Client for Web

```typescript
// src/api/client.ts
import { getAuth } from 'firebase/auth';

const API_BASE_URL = process.env.REACT_APP_API_URL;

interface RequestConfig {
  timeout?: number;
  retryOnTimeout?: boolean;
  maxRetries?: number;
  retryDelays?: number[];
}

const ENDPOINT_CONFIGS: Map<RegExp | string, RequestConfig> = new Map([
  ['/chat', { timeout: 60000, retryOnTimeout: true }],
  ['/enhanced-chat', { timeout: 60000, retryOnTimeout: true }],
  [/\/horoscope\/daily/, { timeout: 90000, retryOnTimeout: true, maxRetries: 2, retryDelays: [2000, 5000] }],
  [/\/horoscope\/weekly/, { timeout: 90000, retryOnTimeout: true, maxRetries: 2, retryDelays: [2000, 5000] }],
  [/\/horoscope\/monthly/, { timeout: 120000, retryOnTimeout: true, maxRetries: 2, retryDelays: [3000, 7000] }],
  [/\/horoscope\/custom/, { timeout: 120000, retryOnTimeout: true, maxRetries: 2, retryDelays: [3000, 7000] }],
]);

const DEFAULT_CONFIG: RequestConfig = { timeout: 30000, retryOnTimeout: false };

function getEndpointConfig(endpoint: string): RequestConfig {
  for (const [pattern, config] of ENDPOINT_CONFIGS) {
    if (typeof pattern === 'string') {
      if (endpoint.includes(pattern)) return config;
    } else if (pattern.test(endpoint)) {
      return config;
    }
  }
  return DEFAULT_CONFIG;
}

async function getAuthToken(): Promise<string | null> {
  const auth = getAuth();
  const user = auth.currentUser;
  if (!user) return null;
  return user.getIdToken();
}

async function request<T>(
  endpoint: string,
  options: RequestInit = {}
): Promise<T> {
  const config = getEndpointConfig(endpoint);
  const maxRetries = config.maxRetries ?? 2;

  const token = await getAuthToken();
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
    ...(token && { Authorization: `Bearer ${token}` }),
    ...options.headers,
  };

  let lastError: Error | null = null;

  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), config.timeout);

    try {
      const response = await fetch(`${API_BASE_URL}${endpoint}`, {
        ...options,
        headers,
        signal: controller.signal,
      });

      clearTimeout(timeoutId);

      if (!response.ok) {
        const error = await response.json().catch(() => ({}));
        throw new Error(error.message || `HTTP ${response.status}`);
      }

      return response.json();
    } catch (error) {
      clearTimeout(timeoutId);
      lastError = error as Error;

      const isTimeout = error instanceof DOMException && error.name === 'AbortError';
      const isRetriable = isTimeout && config.retryOnTimeout;

      if (isRetriable && attempt < maxRetries) {
        const delay = config.retryDelays?.[attempt] ?? Math.pow(2, attempt) * 1000;
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }

      throw error;
    }
  }

  throw lastError;
}

export const apiClient = {
  get: <T>(endpoint: string) => request<T>(endpoint, { method: 'GET' }),
  post: <T>(endpoint: string, data?: any) => request<T>(endpoint, {
    method: 'POST',
    body: data ? JSON.stringify(data) : undefined,
  }),
  put: <T>(endpoint: string, data?: any) => request<T>(endpoint, {
    method: 'PUT',
    body: data ? JSON.stringify(data) : undefined,
  }),
  delete: <T>(endpoint: string) => request<T>(endpoint, { method: 'DELETE' }),
};
```

### Firebase Auth Integration

```typescript
// src/auth/AuthProvider.tsx
import { createContext, useContext, useEffect, useState } from 'react';
import {
  getAuth,
  onAuthStateChanged,
  signInWithPopup,
  GoogleAuthProvider,
  OAuthProvider,
  signOut as firebaseSignOut,
  User as FirebaseUser
} from 'firebase/auth';
import { usersApi } from '../api/users';
import { useStore } from '../store';

interface AuthContextType {
  firebaseUser: FirebaseUser | null;
  loading: boolean;
  signInWithGoogle: () => Promise<void>;
  signInWithApple: () => Promise<void>;
  signOut: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | null>(null);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [firebaseUser, setFirebaseUser] = useState<FirebaseUser | null>(null);
  const [loading, setLoading] = useState(true);
  const { setUserData, signOut: storeSignOut } = useStore();
  const auth = getAuth();

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, async (user) => {
      setFirebaseUser(user);

      if (user) {
        try {
          const userData = await usersApi.getUserByFirebaseUid(user.uid);
          setUserData(transformSubjectDocumentToUser(userData));
        } catch (error) {
          // User exists in Firebase but not in backend - needs onboarding
          console.log('User needs onboarding');
        }
      } else {
        setUserData(null);
      }

      setLoading(false);
    });

    return unsubscribe;
  }, [auth, setUserData]);

  const signInWithGoogle = async () => {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
  };

  const signInWithApple = async () => {
    const provider = new OAuthProvider('apple.com');
    await signInWithPopup(auth, provider);
  };

  const signOut = async () => {
    await firebaseSignOut(auth);
    await storeSignOut();
  };

  return (
    <AuthContext.Provider value={{
      firebaseUser,
      loading,
      signInWithGoogle,
      signInWithApple,
      signOut
    }}>
      {children}
    </AuthContext.Provider>
  );
}

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) throw new Error('useAuth must be used within AuthProvider');
  return context;
};
```

### Performance Recommendations

1. **Code Splitting by Route**
```typescript
import { lazy, Suspense } from 'react';

const ChartPage = lazy(() => import('./pages/ChartPage'));
const RelationshipAnalysisPage = lazy(() => import('./pages/RelationshipAnalysisPage'));

function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/charts/:id" element={<ChartPage />} />
        <Route path="/relationships/:id" element={<RelationshipAnalysisPage />} />
      </Routes>
    </Suspense>
  );
}
```

2. **Memoize Expensive Calculations**
```typescript
import { useMemo } from 'react';

function ChartWheel({ planets, houses, aspects, ascendant }) {
  const positions = useMemo(() =>
    planets.map(p => calculatePosition(p.full_degree, ascendant)),
    [planets, ascendant]
  );

  const aspectLines = useMemo(() =>
    aspects.map(a => calculateAspectLine(a, positions)),
    [aspects, positions]
  );

  return <svg>...</svg>;
}
```

3. **Debounce Search Inputs**
```typescript
import { useDeferredValue, useState } from 'react';

function CelebritySearch() {
  const [searchTerm, setSearchTerm] = useState('');
  const deferredSearchTerm = useDeferredValue(searchTerm);

  // API call uses deferred value
  const { data } = useCelebritySearch(deferredSearchTerm);

  return (
    <input
      value={searchTerm}
      onChange={(e) => setSearchTerm(e.target.value)}
    />
  );
}
```

4. **Virtual Scrolling for Long Lists**
```typescript
import { FixedSizeList } from 'react-window';

function TransitList({ transits }) {
  return (
    <FixedSizeList
      height={400}
      itemCount={transits.length}
      itemSize={80}
    >
      {({ index, style }) => (
        <TransitItem
          transit={transits[index]}
          style={style}
        />
      )}
    </FixedSizeList>
  );
}
```

---

## Appendix: Quick Reference

### Credit Costs

| Action | Credits |
|--------|---------|
| Quick Chart Overview | 10 |
| Full Natal Report | 75 |
| Relationship Overview | 10 |
| Full Relationship Report | 60 |
| Ask Stellium Question | 1 |
| Daily Horoscope | 1 |
| Weekly Horoscope | 2 |

### Tier Monthly Credits

| Tier | Monthly Credits |
|------|-----------------|
| Free | 10 |
| Premium | 200 |
| Pro | 1000 |

### Timeout Configuration Summary

| Endpoint Pattern | Timeout | Retry Delays |
|-----------------|---------|--------------|
| Default | 30s | No retry on timeout |
| `/chat`, `/enhanced-chat` | 60s | Standard backoff |
| `/horoscope/daily`, `/horoscope/weekly` | 90s | 2s, 5s |
| `/horoscope/monthly`, `/horoscope/custom` | 120s | 3s, 7s |

---

*Document generated for StelliumApp web migration. Last updated: December 2024*
